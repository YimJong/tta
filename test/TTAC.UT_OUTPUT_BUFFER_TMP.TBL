DROP TABLE TTAC.UT_OUTPUT_BUFFER_TMP CASCADE CONSTRAINTS;

CREATE TABLE TTAC.UT_OUTPUT_BUFFER_TMP
(
  OUTPUT_ID    RAW(32)                          NOT NULL,
  MESSAGE_ID   NUMBER(38)                       NOT NULL,
  TEXT         VARCHAR2(4000 BYTE),
  ITEM_TYPE    VARCHAR2(1000 BYTE),
  IS_FINISHED  NUMBER(1)                        DEFAULT 0                     NOT NULL, 
  CONSTRAINT UT_OUTPUT_BUFFER_TMP_PK
  PRIMARY KEY
  (OUTPUT_ID, MESSAGE_ID)
  ENABLE VALIDATE
)
ORGANIZATION INDEX
PCTTHRESHOLD 50
TABLESPACE USERS
PCTFREE    10
INITRANS   100
MAXTRANS   255
STORAGE    (
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
OVERFLOW  TABLESPACE USERS
  PCTFREE    10
  INITRANS   100
  MAXTRANS   255
  STORAGE    (
              PCTINCREASE      0
              BUFFER_POOL      DEFAULT
             );


-- Index UT_OUTPUT_BUFFER_TMP_PK is created automatically by Oracle with index organized table UT_OUTPUT_BUFFER_TMP.

ALTER TABLE TTAC.UT_OUTPUT_BUFFER_TMP ADD (
  CONSTRAINT UT_OUTPUT_BUFFER_TMP_CK
  CHECK (
         is_finished = 0 and (text is not null or item_type is not null )
      or is_finished = 1 and text is null and item_type is null )
  ENABLE VALIDATE);


ALTER TABLE TTAC.UT_OUTPUT_BUFFER_TMP ADD (
  CONSTRAINT UT_OUTPUT_BUFFER_FK 
  FOREIGN KEY (OUTPUT_ID) 
  REFERENCES TTAC.UT_OUTPUT_BUFFER_INFO_TMP (OUTPUT_ID)
  ON DELETE CASCADE
  ENABLE VALIDATE);
